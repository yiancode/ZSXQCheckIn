# 知识星球项目打卡展示工具 - 需求分析文档 v1.1

## 文档信息
- **项目名称**：知识星球项目打卡展示工具
- **文档版本**：v1.1
- **创建日期**：2025-10-19
- **最近更新**：2025-10-19
- **项目阶段**：需求分析阶段
- **下一阶段**：接口细化与技术方案设计

---

## 目录
1. [项目背景](#1-项目背景)
2. [项目目标](#2-项目目标)
3. [用户分析](#3-用户分析)
4. [核心需求](#4-核心需求)
5. [功能规划](#5-功能规划)
6. [技术选型](#6-技术选型)
7. [部署架构](#7-部署架构)
8. [非功能性需求](#8-非功能性需求)
9. [项目分期规划](#9-项目分期规划)
10. [风险与限制](#10-风险与限制)
11. [后续规划](#11-后续规划)
12. [待明确事项](#12-待明确事项)
13. [名词解释](#13-名词解释)
14. [参考资料](#14-参考资料)
15. [文档变更记录](#15-文档变更记录)
16. [审批与确认](#16-审批与确认)

---

## 1. 项目背景

### 1.1 问题描述
知识星球是面向社群运营的 APP，具备项目打卡能力，但当前痛点包括：
- 官方无 PC 管理界面，运营者只能依赖移动端查看。
- 官方未开放公共 API，难以与自建工具整合。
- 星主管理者无法快速洞察打卡趋势和成员活跃度。
- 打卡数据难以分享给成员或外部渠道。

### 1.2 解决方案
通过抓包逆向知识星球打卡接口，封装统一的后端 API，并提供 Web 展示前端，帮助星主在 PC 上完成数据查看、排行榜展示与基本统计。

### 1.3 项目价值
- **星主**：低门槛掌握打卡数据趋势、提高运营效率。
- **成员**：PC 端查看排行榜，增强持续打卡动力。
- **生态**：开源部署方案，便于其他星主复用。

---

## 2. 项目目标

### 2.1 核心目标
1. 封装知识星球打卡接口为标准 RESTful API。
2. 构建 PC 端管理与展示界面（域名：zsxq.dc401.com）。
3. 发布开源部署方案，便于其他星主自建。

### 2.2 业务目标
- 支撑单星球 1,000 名成员的日常访问。
- 提供实时（延迟 ≤ 1 分钟）的打卡数据展示。
- 通过排行榜和统计面板提升成员活跃度。
- 降低非技术用户的部署与使用门槛。

### 2.3 非目标
- 不做多星球统一管理，单实例仅服务一个星球。
- 不提供打卡记录的新增、修改或补卡能力。
- 不实现深度数据分析、AI 辅助或商业化能力。
- 不建设复杂权限体系，当前版本默认公开访问。

---

## 3. 用户分析

### 3.1 用户画像
| 用户类型 | 数量级 | 特征 | 核心诉求 |
|----------|--------|------|----------|
| 星主 | 1 | 具备社群运营经验，非技术背景居多 | 快速掌握项目进展、驱动成员参与 |
| 星球管理员 | 1-3 | 协助星主营运 | 快速导出或查看最新数据 |
| 星球成员 | 1000+ | 关注个人打卡成绩 | 查看排行榜、了解同伴情况 |
| 外部星主 | 不定 | 潜在自建用户 | 参考架构、快速部署 |

### 3.2 用户故事
- 作为星主，我希望在 PC 上查看各项目的参与度与完成人数，以便及时调整运营策略。
- 作为星球管理员，我希望能够导出或截图排行榜与统计图表，方便汇报。
- 作为星球成员，我希望快速知道自己的排名与连续打卡天数，保持打卡动力。
- 作为新星主，我希望有清晰的部署指南和 API 文档，以便复制成功经验。

---

## 4. 核心需求

### 4.1 数据需求
| 维度 | 字段 | 描述 | 计算/来源 |
|------|------|------|-----------|
| 项目指标 | 目标天数 | 计划打卡天数 | 来自知识星球原始接口 |
| 项目指标 | 完成率 | 已完成人数 ÷ 参与人数 | 保留两位小数 |
| 项目指标 | 活跃度 | 最近 7 日打卡人数 ÷ 参与人数 | 依赖每日统计数据 |
| 项目指标 | 平均完成率 | 各成员完成率平均值 | 成员完成率 = 累计打卡次数 ÷ 目标天数 |
| 成员指标 | 连续天数 | 最近无间断打卡天数 | 由排行榜接口提供 |
| 成员指标 | 累计次数 | 累计打卡数量 | 由排行榜或记录接口提供 |
| 统计图表 | 每日打卡数 | 指定日期打卡次数 | 由统计接口提供 |

### 4.2 功能需求（含优先级与验收）
| 编号 | 功能 | 描述 | 优先级 | 验收标准 |
|------|------|------|--------|----------|
| FR-01 | 项目列表 | 显示所有打卡项目，支持状态筛选 | P0 | 能按 ongoing/closed/over 切换列表，数据与接口一致 |
| FR-02 | 项目概览卡片 | 展示参与人数、完成率、活跃度 | P0 | 指标在前端展示且与计算公式一致，刷新延迟 ≤ 60 秒 |
| FR-03 | 排行榜 | 展示连续与累计排行榜，支持分页 | P0 | 切换榜单、翻页时响应 < 500ms，排名准确，当前成员高亮 |
| FR-04 | 项目统计 | 提供每日打卡趋势图 | P1 | 折线图覆盖最近 30 天，可导出 CSV |
| FR-05 | 打卡记录 | 展示项目下的打卡内容列表 | P1 | 支持分页（30 条/页），可按日期筛选 |
| FR-06 | 配置管理 | 通过 config.yml 设置 Token、Redis 等 | P0 | 按文档配置后系统可启动，缺失必填项时给出错误提示 |
| FR-07 | 数据导出 | 导出排行榜与项目概览为 CSV | P2 | 导出文件字段完整，支持 UTF-8 |

### 4.3 依赖与约束
- 必须能够持续获取合法的 Authorization Token，失效后需人工更新。
- 受限于上游接口的请求频率，不建议单项目刷新频率低于 30 秒。
- 部分接口需要 X-Signature，需在后端实现签名算法或引入中间层。

---

## 5. 功能规划
- **后端 API**：统一封装数据，提供缓存、错误处理与权限控制。
- **前端界面**：包含仪表盘、排行榜、项目详情三大模块。
- **运维工具**：提供启动脚本、日志监控与健康检查接口。

---

## 6. 技术选型
| 模块 | 技术 | 说明 |
|------|------|------|
| 后端 | Python 3.10 + Flask 3.0 | 提供 REST API 与调度能力 |
| 缓存 | Redis 6+ | 缓存项目列表与排行榜，降低接口压力 |
| 定时任务 | APScheduler | 定时刷新数据与清理缓存 |
| 前端 | React 18 + Vite | 构建响应式 UI |
| UI | Ant Design 5 | 快速搭建后台界面 |
| 部署 | Nginx + Gunicorn | 提供反向代理与进程管理 |

---

## 7. 部署架构
1. 通过 Flask 提供 /api 服务，挂载在 Gunicorn。
2. Redis 部署在同一子网，提供缓存与队列功能。
3. 前端静态资源由 Vite 构建后托管在 Nginx。
4. Nginx 负责反向代理 API 与静态资源，支持 HTTPS。

---

## 8. 非功能性需求
| 类别 | 指标 | 目标值 | 验收方式 |
|------|------|--------|----------|
| 性能 | 接口响应时间 | P0 功能 ≤ 300ms（缓存命中），≤ 800ms（直连） | 压测 100 RPS |
| 性能 | 并发能力 | 支持 200 并发连接 | Locust 压测 |
| 可用性 | 7 日可用率 | ≥ 99.5% | 部署监控统计 |
| 可维护性 | 日志留存 | 最近 7 日日志可查 | 日志轮转配置 |
| 安全性 | Token 暴露风险 | 日志中不输出敏感字段 | 人工抽检 |
| 配置 | 部署耗时 | 新环境 30 分钟内可上线 | 依照部署手册演练 |

---

## 9. 项目分期规划
| 阶段 | 时间 | 内容 |
|------|------|------|
| Phase 0 | 2025-10 W3 | 抓包与需求梳理（已完成） |
| Phase 1 | 2025-10 W4 | 接口封装、缓存策略落地 |
| Phase 2 | 2025-11 W1 | 前端界面与联调完成 |
| Phase 3 | 2025-11 W2 | 压测、部署与文档收尾 |

---

## 10. 风险与限制

### 10.1 主要风险
| 风险 | 影响 | 等级 | 应对策略 |
|------|------|------|----------|
| Token 失效 | 无法获取数据 | 高 | 建立定期更新流程，预警日志 |
| 请求限流 | 数据刷新失败 | 中 | 增加缓存与退避策略，降低频率 |
| 签名算法变更 | 接口失效 | 高 | 持续监控客户端更新，必要时人工抓包 |
| Redis 故障 | 数据延迟 | 中 | 配置持久化与备份实例 |

### 10.2 已知限制
- 排行榜接口最多返回 200 条数据，超过需分页拉取。
- 知识星球接口未提供完整历史数据，只可查询近期记录。
- 当前版本未对外提供身份校验，部署时需通过 Nginx 增加访问控制（Basic Auth/IP 白名单）。

---

## 11. 后续规划
- 引入多维度筛选（按成员标签、时间范围）。
- 丰富统计图表（热力图、漏斗图）。
- 支持导出 Excel/PDF 报表。
- 评估多星球支持方案。

---

## 12. 待明确事项
| 分类 | 问题 | 责任人 | 截止时间 |
|------|------|--------|----------|
| 接口 | X-Signature 生成方案 | 后端负责人 | Phase 1 |
| 接口 | Token 有效期与刷新策略 | 星主 | Phase 1 |
| 缓存 | 项目刷新频率（建议值） | 项目组 | Phase 1 |
| 前端 | UI 主题与配色方案 | 设计支持 | Phase 2 |
| 运维 | 生产服务器规格 | 运维支持 | Phase 2 |

---

## 13. 名词解释
- **连续打卡天数**：成员在最近连续打卡的天数，中途断签清零。
- **累计打卡次数**：成员参与项目以来的打卡总次数。
- **完成率**：成员打卡天数 ÷ 项目目标天数。
- **活跃度**：最近 7 天内打卡成员数 ÷ 总参与人数。
- **Token**：知识星球接口授权凭据，格式 {UUID}_{HASH}。

---

## 14. 参考资料
- Flask 官方文档：https://flask.palletsprojects.com/
- React 官方文档：https://react.dev/
- Redis 官方文档：https://redis.io/
- Ant Design：https://ant.design/

---

## 15. 文档变更记录
| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0 | 2025-10-19 | 项目组 | 初始版本 |
| v1.1 | 2025-10-19 | 项目组 | 修复编码问题，补充指标定义、优先级、非功能指标与待明确事项 |

---

## 16. 审批与确认
- [x] 项目背景与目标确认
- [x] 功能需求确认
- [x] 非功能需求确认
- [ ] 签名与安全策略确认

**下一阶段行动项**：
1. 确认签名生成与 Token 维护机制。
2. 完成后端接口定义与缓存设计。
3. 产出前端高保真原型并评审。

---

**文档结束**
