# 知识星球项目打卡展示工具 - 需求分析文档 v1.0

## 文档信息
- **项目名称**: 知识星球项目打卡展示工具
- **文档版本**: v1.0
- **创建日期**: 2025-10-19
- **项目阶段**: 需求分析阶段
- **下一阶段**: 接口细节分析与技术方案设计

---

## 目录
1. [项目背景](#1-项目背景)
2. [项目目标](#2-项目目标)
3. [用户分析](#3-用户分析)
4. [核心需求](#4-核心需求)
5. [功能规划](#5-功能规划)
6. [技术选型](#6-技术选型)
7. [部署架构](#7-部署架构)
8. [非功能性需求](#8-非功能性需求)
9. [项目分期规划](#9-项目分期规划)
10. [风险与限制](#10-风险与限制)
11. [后续规划](#11-后续规划)

---

## 1. 项目背景

### 1.1 问题描述
知识星球是一款社群产品APP，提供了项目打卡功能，用户可以：
- 在APP中打卡自己的项目
- 查看打卡进度和成果
- 查看排行榜，了解自己在群体中的排名

**存在的问题**：
1. ❌ PC端没有项目打卡功能
2. ❌ 官方未提供任何API接口
3. ❌ 星主无法在电脑上方便地管理和查看打卡数据
4. ❌ 无法将打卡数据集成到自己的工具或网站中

### 1.2 解决方案
通过Charles抓包APP，分析知识星球的项目打卡接口，将这些接口封装成标准化API，并开发Web展示页面，解决以上问题。

### 1.3 项目价值
- **对星主**: 提供PC端数据管理能力，提升运营效率
- **对成员**: 通过Web端查看排行榜，增强打卡动力
- **对社区**: 开源项目，让更多星主受益

---

## 2. 项目目标

### 2.1 核心目标
1. **封装API**: 将知识星球打卡接口封装成标准RESTful API
2. **Web展示**: 开发PC端展示页面，部署到 zsxq.dc401.com
3. **开源共享**: 代码开源，让其他星主可自行部署

### 2.2 业务目标
- 支持1000+用户同时访问
- 提供实时的打卡数据查询能力
- 通过排行榜功能激励成员持续打卡
- 降低星主管理打卡数据的门槛（非开发者也能使用）

### 2.3 非目标（明确不做的事）
- ❌ 不做多星球统一管理（每个星主独立部署）
- ❌ 不做历史数据深度分析
- ❌ 不做打卡编辑/删除/补卡功能
- ❌ 不做打卡提醒功能
- ❌ 不做社区互动功能（评论、点赞等）
- ❌ 不接入其他平台（微信、飞书等）
- ❌ 不做复杂的权限系统（完全公开访问）

---

## 3. 用户分析

### 3.1 目标用户
| 用户类型 | 数量 | 特征 | 核心诉求 |
|---------|------|------|----------|
| **星主** | 主要用户 | 副业搞钱类星球创建者 | 便捷管理打卡数据，激励成员 |
| **星球管理员** | 次要用户 | 协助星主运营 | 查看数据，了解成员状态 |
| **星球成员** | 最终用户 | 参与打卡的学员 | 查看排行榜，了解自己排名 |
| **其他星主** | 潜在用户 | 其他知识星球的创建者 | 获取开源代码，自行部署 |

### 3.2 用户特征
- **技术水平**: 非开发者为主
- **使用场景**: PC端查看数据、日常运营管理
- **使用频率**: 星主每天查看，成员不定期查看
- **预计规模**: 单个星球约1000人

### 3.3 用户故事

**作为星主，我希望**：
- 在PC端查看所有打卡项目的概况
- 看到每个项目的参与人数和完成率
- 查看连续打卡和累计打卡排行榜
- 了解今日/本周/本月的打卡统计数据
- 配置简单，不需要懂编程

**作为星球成员，我希望**：
- 在PC端看到自己的排名
- 了解其他人的打卡情况
- 看到项目的整体进展

**作为API使用者（其他星主），我希望**：
- 有详细的API文档
- 接口稳定可靠
- 能够集成到自己的工具中

---

## 4. 核心需求

### 4.1 数据需求

#### 4.1.1 项目维度数据
```yaml
项目基础信息:
  - 项目ID
  - 项目名称
  - 目标天数
  - 参与人数
  - 已完成人数
  - 完成率
  - 最近打卡时间

项目统计数据:
  - 今日打卡数
  - 本周打卡数
  - 本月打卡数
  - 总计打卡数
  - 活跃度（定义待明确）
  - 平均完成率
```

#### 4.1.2 用户维度数据
```yaml
用户基础信息:
  - 用户ID
  - 用户姓名

用户打卡数据:
  - 连续打卡天数
  - 累计打卡次数
  - 完成率
  - 打卡时间列表
```

#### 4.1.3 排行榜数据
```yaml
连续打卡排行榜:
  - 排名
  - 用户ID
  - 用户姓名
  - 连续打卡天数
  - 完成率

累计打卡排行榜:
  - 排名
  - 用户ID
  - 用户姓名
  - 累计打卡次数
  - 完成率
```

### 4.2 功能需求

#### 4.2.1 API功能
1. **项目列表查询**: 获取星球下所有打卡项目
2. **项目详情查询**: 获取单个项目的详细信息
3. **排行榜查询**: 获取连续打卡榜和累计打卡榜
4. **统计数据查询**: 获取项目和用户的统计数据
5. **打卡记录查询**: 获取项目的所有打卡记录

#### 4.2.2 Web页面功能
1. **项目列表页**: 展示所有项目概况
2. **项目详情页**: 展示单个项目的详细数据和排行榜
3. **数据缓存**: 定时缓存数据，减少API调用
4. **错误处理**: Token失效时显示联系方式

---

## 5. 功能规划

### 5.1 第一阶段：后端API开发

#### 5.1.1 API接口设计

**A. 项目相关接口**
```
GET /api/projects
功能: 获取所有项目列表
请求参数:
  - token (必需): 知识星球访问令牌
返回数据:
  - 项目列表（ID、名称、目标天数、参与人数、完成率等）
```

**B. 排行榜接口**
```
GET /api/projects/{projectId}/leaderboard/continuous
功能: 获取连续打卡排行榜
请求参数:
  - token (必需)
  - limit (可选): 返回数量，默认100
返回数据:
  - 排行榜列表（最多100条）

GET /api/projects/{projectId}/leaderboard/total
功能: 获取累计打卡排行榜
请求参数: 同上
返回数据: 同上
```

**C. 统计数据接口**
```
GET /api/projects/{projectId}/stats
功能: 获取项目统计数据
请求参数:
  - token (必需)
返回数据:
  - 参与人数、活跃度、平均完成率
  - 今日/本周/本月/总计打卡数

GET /api/users/{userId}/stats
功能: 获取用户统计数据
请求参数:
  - token (必需)
  - projectId (必需): 项目ID
返回数据:
  - 连续打卡天数、总打卡次数、完成率

GET /api/projects/{projectId}/checkins
功能: 获取打卡记录
请求参数:
  - token (必需)
返回数据:
  - 用户ID、姓名、打卡时间列表
```

#### 5.1.2 API特性
- ✅ 实时获取数据（不做缓存）
- ✅ RESTful风格
- ✅ Token通过请求参数传递（不写死）
- ✅ 统一的错误码和错误信息
- ✅ 完整的API文档（Swagger/Postman）

#### 5.1.3 错误处理
```yaml
Token失效:
  - HTTP状态码: 401
  - 错误信息: "Token已失效，请联系管理员更新。微信：20133213"

知识星球API限流:
  - HTTP状态码: 429
  - 错误信息: "请求过于频繁，请稍后再试"

参数错误:
  - HTTP状态码: 400
  - 错误信息: 具体参数错误说明

系统错误:
  - HTTP状态码: 500
  - 错误信息: "系统错误，请稍后再试"
```

---

### 5.2 第二阶段：Web页面开发

#### 5.2.1 页面结构

**A. 首页 - 项目列表**
```
布局: 卡片网格布局
每个项目卡片包含:
  ├─ 项目名称（标题）
  ├─ 目标天数 / 已完成人数
  ├─ 完成率（进度条）
  ├─ 最近打卡时间
  ├─ 快速排行榜（Top 10，可折叠）
  │   └─ 排名、姓名、打卡数
  └─ "查看详情"按钮

交互:
  - 点击卡片或按钮进入项目详情页
  - 悬停显示更多信息
```

**B. 项目详情页**
```
布局: 上下分区

顶部区域 - 项目概况:
  ├─ 项目基础信息
  │   └─ 项目名称、目标天数、参与人数
  │
  └─ 统计卡片（四宫格）
      ├─ 今日打卡数
      ├─ 本周打卡数
      ├─ 本月打卡数
      └─ 总计打卡数

中部区域 - Tab切换:
  ├─ Tab1: 连续打卡排行榜
  │   └─ 表格展示（排名、姓名、连续天数、完成率）
  │
  ├─ Tab2: 累计打卡排行榜
  │   └─ 表格展示（排名、姓名、累计次数、完成率）
  │
  └─ Tab3: 打卡记录
      └─ 时间线展示（用户姓名、打卡时间）

底部区域:
  └─ 返回首页按钮
```

#### 5.2.2 页面特性
- ✅ 完全公开访问（无需登录）
- ✅ 响应式设计（PC优先，兼容移动端）
- ✅ 数据自动刷新（基于缓存间隔）
- ✅ 加载状态（Skeleton/Loading）
- ✅ 空状态提示（暂无数据）
- ✅ 错误状态提示（Token失效、网络错误等）

#### 5.2.3 缓存机制
```yaml
缓存策略:
  - 启用条件: 仅在Web页面展示时启用
  - 缓存介质: Redis
  - 缓存间隔: 可配置（建议1小时）
  - 缓存Key: project:{projectId}:data
  - 刷新机制: 定时任务自动刷新

API直接调用:
  - 不走缓存，实时获取最新数据
```

---

## 6. 技术选型

### 6.1 技术栈
```yaml
后端:
  - 语言: Python 3.x
  - 框架: Flask
  - 数据库: Redis（缓存）
  - HTTP客户端: requests
  - 任务调度: APScheduler（定时缓存）

前端:
  - 框架: React 18+
  - UI库: Ant Design / Material-UI（待定）
  - 状态管理: React Hooks / Zustand（轻量）
  - HTTP客户端: axios
  - 构建工具: Vite / Create React App

部署:
  - 容器化: Docker（可选）
  - Web服务器: Nginx（前端静态资源）
  - 反向代理: Nginx（API代理）
```

### 6.2 技术选型理由
| 技术 | 选择理由 |
|------|----------|
| **Flask** | 轻量、简单、适合小型API项目 |
| **Redis** | 高性能、支持定时过期、易部署 |
| **React** | 生态成熟、组件化、社区活跃 |
| **Docker** | 简化部署、环境一致性 |

---

## 7. 部署架构

### 7.1 部署模式
```
单星主单部署模式:
  - 每个星主独立部署一套系统
  - 数据完全隔离
  - 配置各自的Token和星球ID
```

### 7.2 系统架构图
```
┌─────────────┐
│   用户浏览器   │
└──────┬──────┘
       │ HTTP
       ▼
┌─────────────┐
│    Nginx    │ (前端静态资源 + API反向代理)
└──────┬──────┘
       │
       ├─────────────────┐
       │                 │
       ▼                 ▼
┌─────────────┐   ┌─────────────┐
│ React前端    │   │ Flask后端   │
│ (Web页面)   │   │  (API服务)  │
└─────────────┘   └──────┬──────┘
                         │
                         ├────────────┬──────────┐
                         │            │          │
                         ▼            ▼          ▼
                  ┌───────────┐  ┌──────┐  ┌──────────┐
                  │知识星球API │  │Redis │  │定时任务  │
                  └───────────┘  └──────┘  └──────────┘
```

### 7.3 配置文件设计
```yaml
# config.yml
知识星球:
  token: "your_zsxq_token"
  group_id: "your_group_id"

缓存配置:
  enabled: true
  interval: 3600  # 秒（1小时）
  host: "localhost"
  port: 6379
  db: 0

系统配置:
  contact:
    type: "微信"
    value: "20133213"

  rate_limit:
    enabled: true
    max_requests: 100  # 每分钟最大请求数

排行榜配置:
  max_items: 100  # API返回最大数量
  homepage_preview: 10  # 首页预览数量
```

---

## 8. 非功能性需求

### 8.1 性能需求
```yaml
响应时间:
  - API接口: < 2秒
  - 页面首屏加载: < 3秒
  - 排行榜渲染: < 1秒

并发能力:
  - 支持1000人同时在线
  - API QPS: ≥ 50

资源占用:
  - 内存占用: < 512MB
  - CPU占用: < 30%（正常负载）
```

### 8.2 可用性需求
```yaml
服务可用性:
  - 目标: 99%+
  - 7x24小时运行

容错能力:
  - 知识星球API失败: 显示友好错误提示
  - Token失效: 明确告知联系方式
  - Redis故障: 降级到实时查询（不缓存）
```

### 8.3 安全需求
```yaml
数据安全:
  - Token不明文存储在代码中
  - 配置文件不上传到代码仓库(.gitignore)
  - API接口防止SQL注入（虽然不用SQL数据库）

访问控制:
  - 当前阶段: 完全公开（无需登录）
  - 未来可扩展: 支持Token验证

限流保护:
  - 防止恶意刷接口
  - 保护知识星球API不被过度调用
```

### 8.4 可维护性需求
```yaml
代码质量:
  - 清晰的代码注释
  - 统一的代码风格
  - 模块化设计

日志记录:
  - API调用日志
  - 错误日志
  - 缓存刷新日志

监控告警:
  - Token即将过期提醒（可选）
  - 接口异常告警（可选）
```

---

## 9. 项目分期规划

### 9.1 阶段划分

#### 第一阶段：接口分析与后端开发（预计2-3周）
```yaml
里程碑1: 接口分析完成
  - 整理知识星球所有相关API
  - 分析请求参数和返回数据结构
  - 验证接口可用性

里程碑2: 后端API开发完成
  - 完成所有后端接口
  - 完成错误处理
  - 完成API文档
  - 完成单元测试

交付物:
  - API接口文档
  - 后端代码
  - 部署说明文档
```

#### 第二阶段：前端开发与集成（预计2-3周）
```yaml
里程碑3: 前端页面开发完成
  - 完成项目列表页
  - 完成项目详情页
  - 完成所有交互功能

里程碑4: 缓存机制开发完成
  - 完成Redis集成
  - 完成定时任务
  - 完成缓存刷新逻辑

里程碑5: 前后端联调完成
  - 完成接口对接
  - 完成功能测试
  - 完成性能优化

交付物:
  - 前端代码
  - 完整系统
  - 用户使用手册
```

#### 第三阶段：部署与开源（预计1周）
```yaml
里程碑6: 部署上线
  - 部署到 zsxq.dc401.com
  - 配置域名和SSL
  - 线上测试

里程碑7: 开源准备
  - 整理代码
  - 编写README
  - 编写部署文档
  - 选择开源License

交付物:
  - 线上系统
  - 开源代码仓库
  - 完整文档
```

### 9.2 时间规划
```
总计: 5-7周

第1-3周: 接口分析 + 后端开发
第4-6周: 前端开发 + 集成测试
第7周:   部署上线 + 开源发布
```

---

## 10. 风险与限制

### 10.1 技术风险
```yaml
知识星球API变更:
  - 风险: 官方修改接口导致无法使用
  - 应对: 监控接口变化，及时更新
  - 影响: 高

接口限流:
  - 风险: 知识星球限制调用频率
  - 应对: 实现缓存机制，减少调用
  - 影响: 中

Token过期:
  - 风险: Token定期失效需要更新
  - 应对: 配置化管理，提供明确提示
  - 影响: 中

抓包接口不完整:
  - 风险: 部分数据无法获取
  - 应对: 尽量通过现有接口组合实现
  - 影响: 低
```

### 10.2 业务风险
```yaml
用户规模超预期:
  - 风险: 并发访问超过系统承载能力
  - 应对: 优化缓存，考虑CDN加速
  - 影响: 中

数据隐私问题:
  - 风险: 用户不希望打卡数据公开
  - 应对: 当前版本完全公开，未来可加权限
  - 影响: 低（星球本身数据已公开）
```

### 10.3 限制说明
```yaml
当前阶段不支持:
  - ❌ 多星球统一管理
  - ❌ 历史数据分析
  - ❌ 数据编辑功能
  - ❌ 复杂的权限系统
  - ❌ 移动端APP

数据限制:
  - 排行榜最多100条
  - 缓存最长1小时
  - 不保存永久数据
```

---

## 11. 后续规划

### 11.1 第一版发布后的优化方向
```yaml
性能优化:
  - 引入CDN加速
  - 前端代码分割
  - 图表懒加载

功能增强:
  - 数据可视化图表
  - 个人主页（查看单个用户数据）
  - 导出功能（Excel/PDF）
  - 多维度筛选和排序

用户体验:
  - 移动端优化
  - 暗黑模式
  - 自定义主题色
```

### 11.2 长期规划（可选）
```yaml
社区功能:
  - 用户评论
  - 打卡分享
  - 成就系统

数据分析:
  - 打卡趋势分析
  - 用户活跃度分析
  - 项目效果评估

商业化:
  - SaaS化部署
  - 付费高级功能
  - 数据报表服务
```

---

## 12. 待明确事项（下一阶段讨论）

### 12.1 接口细节待确认
```yaml
需要整理:
  - ✅ 知识星球API的完整列表
  - ✅ 每个API的请求方法、参数、返回格式
  - ✅ Token的获取方式和有效期
  - ✅ 接口的调用频率限制
  - ✅ 错误码定义
  - ✅ 数据字段的具体含义（如"活跃度"如何计算）
```

### 12.2 技术细节待确认
```yaml
需要明确:
  - ✅ Redis的具体使用方式（Key设计、过期策略）
  - ✅ 定时任务的触发频率和执行逻辑
  - ✅ 前端UI库的最终选择
  - ✅ 部署环境的服务器配置
```

---

## 13. 附录

### 13.1 名词解释
```yaml
知识星球:
  - 一款内容社群产品APP

项目打卡:
  - 用户在知识星球中记录项目进度的功能

连续打卡:
  - 用户连续每天打卡的天数

累计打卡:
  - 用户总共打卡的次数（不要求连续）

完成率:
  - 实际打卡天数 / 目标天数 × 100%

活跃度:
  - （待明确具体定义）
```

### 13.2 参考资料
```yaml
技术文档:
  - Flask官方文档: https://flask.palletsprojects.com/
  - React官方文档: https://react.dev/
  - Redis官方文档: https://redis.io/

工具:
  - Charles抓包工具
  - Postman API调试工具
  - Swagger API文档工具
```

---

## 14. 文档变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0 | 2025-10-19 | - | 初始版本，完成需求分析 |

---

## 15. 审批与确认

### 15.1 需求确认
- [x] 项目背景和目标确认
- [x] 功能需求确认
- [x] 技术选型确认
- [x] 项目规划确认

### 15.2 下一步行动
✅ **当前阶段**: 需求分析完成
⏭️ **下一阶段**: 接口细节分析与技术方案设计

**下一阶段需要做的事**:
1. 整理知识星球抓包得到的所有API接口
2. 分析每个接口的详细参数和返回数据
3. 设计后端API的详细接口文档
4. 设计数据库（Redis）的Key结构
5. 确定前端UI库和组件设计

---

**文档结束**
